os: linux
language: node_js
node_js:
  - 14

branches:
  only:
    - main

before_script:
  - yarn

script:
  - yarn lint
  - yarn test:unit:coverage-upload
  - yarn test:integration:coverage
  - yarn docs
  - yarn build

deploy:
  - provider: npm
    skip_cleanup: true
    email: $NPM_EMAIL
    api_token: $NPM_TOKEN
    on:
      branch: main

  - provider: pages
    skip_cleanup: true
    local_dir: docs/
    token: $GITHUB_TOKEN
    on:
      branch: main
